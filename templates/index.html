{% extends "base.html" %}
{% block content %}

<div class="page">

  {% if session.get('id') %}
    <h2 class="page-title">
      Welcome back <span class="muted">[{{ session.get('username') }}]</span>, browse recent movie reviews below.
    </h2>
  {% else %}
    <h2 class="page-title">
      Welcome, browse recent movie reviews below. 
      <span class="muted">Log in to review.</span>
    </h2>
  {% endif %}

  <form method="get" action="/" class="filter-bar">
    <select name="sort">
      <option value="newest" {% if sort=='newest' %}selected{% endif %}>Newest posted</option>
      <option value="watched" {% if sort=='watched' %}selected{% endif %}>Date watched</option>
      <option value="rating_desc" {% if sort=='rating_desc' %}selected{% endif %}>Rating (high → low)</option>
      <option value="rating_asc" {% if sort=='rating_asc' %}selected{% endif %}>Rating (low → high)</option>
    </select>
  
    <select name="min_rating">
      <option value="">Any rating</option>
      {% for r in range(1,6) %}
        <option value="{{ r }}" {% if min_rating==r %}selected{% endif %}>{{ r }}+</option>
      {% endfor %}
    </select>
  
  
    <button class="primary-btn" type="submit">Apply</button>
  </form>
  

  <section class="poster-grid">
    {% for review in reviews %}

      <article class="poster-card">

        <a href="{{ url_for('view_review', review_id=review['id']) }}" 
           class="card-overlay"></a>

        <div class="poster-frame">
          {% if review['poster_filename'] %}
            <img class="poster-img"
                 src="{{ url_for('static', filename='uploads/' + review['poster_filename']) }}"
                 alt="Poster for {{ review['movie_title'] }}">
          {% else %}
            <img class="poster-img"
                 src="{{ url_for('static', filename='css/icons/images/placeholder.png') }}"
                 alt="Poster placeholder">
          {% endif %}
        </div>

        <div class="mini-meta">
          <span class="mini-user">[{{ review['username'] }}]</span>
          <span class="mini-date">{{ review['review_date'] }}</span>
        </div>

        <div class="stars-row" aria-label="Rating: {{ review['rating'] }} out of 5">
          {% for i in range(1, 6) %}
            {% if i <= review['rating'] %}
              <span class="star filled">★</span>
            {% else %}
              <span class="star">★</span>
            {% endif %}
          {% endfor %}
        </div>

        <div class="movie-name">{{ review['movie_title'] }}</div>

        {% if review['can_edit'] %}
          <div class="owner-actions">
            
            <a class="navbtn"
               href="{{ url_for('edit_review', review_id=review['id']) }}">
              Edit
            </a>

            <form method="POST"
                  action="{{ url_for('delete_review', review_id=review['id']) }}"
                  style="display:inline;">
              <button type="submit" class="navbtn navbtn-red">
                Delete
              </button>
            </form>

          </div>
        {% endif %}

      </article>


      
    {% endfor %}
  </section>

</div>

{% endblock %}
