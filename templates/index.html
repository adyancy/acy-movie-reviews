{% extends "base.html" %}
{% block content %}

<div class="page">

  {% if session.get('id') %}
    <h2 class="page-title">
      Welcome back <span class="muted">[{{ session.get('username') }}]</span>, browse recent movie reviews below.
    </h2>
  {% else %}
    <h2 class="page-title">
      Welcome, browse recent movie reviews below. <span class="muted">Log in to review.</span>
    </h2>
  {% endif %}

  <section class="poster-grid">
    {% for review in reviews %}

      <!-- CLICKABLE CARD -->
      <article class="poster-card"
               onclick="window.location='{{ url_for('view_review', review_id=review['id']) }}'"
               style="cursor:pointer;">

        <div class="poster-frame">
          {% if review['poster_filename'] %}
            <img class="poster-img"
                 src="{{ url_for('static', filename='uploads/' + review['poster_filename']) }}"
                 alt="Poster for {{ review['movie_title'] }}">
          {% else %}
            <img class="poster-img"
                 src="{{ url_for('static', filename='css/icons/images/placeholder.png') }}"
                 alt="Poster placeholder">
          {% endif %}
        </div>

        <div class="mini-meta">
          <span class="mini-user">[{{ review['username'] }}]</span>
          <span class="mini-date">{{ review['review_date'] }}</span>
        </div>

        <div class="stars-row" aria-label="Rating: {{ review['rating'] }} out of 5">
          {% for i in range(1, 6) %}
            {% if i <= review['rating'] %}
              <span class="star filled">★</span>
            {% else %}
              <span class="star">★</span>
            {% endif %}
          {% endfor %}
        </div>

        <div class="movie-name">{{ review['movie_title'] }}</div>

        {% if review['can_edit'] %}
          <div class="owner-actions" onclick="event.stopPropagation();">
            
            <a class="navbtn"
               href="{{ url_for('edit_review', review_id=review['id']) }}">
              Edit
            </a>

            <form method="POST"
                  action="{{ url_for('delete_review', review_id=review['id']) }}"
                  style="display:inline;"
                  onclick="event.stopPropagation();">
              <button type="submit" class="navbtn navbtn-red">
                Delete
              </button>
            </form>

          </div>
        {% endif %}

      </article>

    {% endfor %}
  </section>

</div>

{% endblock %}
